function GRID(){var divAll=null;var divTou=null;var divTi=null;var divSum=null;var divTiLeftCol=null;var divTouLeftCol=null;var divSumLeftCol=null;var inputSort=null;var inputSortName=null;var inputPk=null;var tabTou=null;var tabTi=null;var tabSum=null;var tableArray=new Array();var sortCol=0;var currentLine=null;var isMouDown=false;var isCanSort=true;var OldPlace=null;var nowPlace=null;var curTd=null;var curHr=null;var primaryKeyCol=-1;var deleteCol=-1;var indexCol=-1;var lastSortTd=null;var isSubmit=true;var outCanSort=true;var paddingLeft=0;var xmlroot=null;var OpenImg="open.gif";var CloseImg="close.gif";var sortType="1";var orderType="1";this.format="";this.name=null;this.init=init;function init(odivid,hasLeft,Index,primaryKey,Delete,clickEvent,dblclickEvent){this.name=odivid;divAll=document.all(odivid);if(divAll!=null&&divAll.tagName=="DIV"){divTou=divAll.children[0].children[0];divTi=divAll.children[1];divSum=divAll.children[2].children[0];divTiLeftCol=divAll.children[3];divTouLeftCol=divAll.children[0].children[1];divSumLeftCol=divAll.children[2].children[1];inputSort=divAll.children[4];inputSortName=divAll.children[5];inputPk=divAll.children[6];if(divTou!=null)tabTou=divTou.children[0];if(divTi!=null)tabTi=divTi.children[0];if(divSum!=null)tabSum=divSum.children[0];divSum.parentElement.style.top=parseInt(divTi.offsetTop)+parseInt(divTi.clientHeight)-(parseInt(divSum.clientHeight))+1;divTiLeftCol.style.height=divTi.clientHeight-divSum.clientHeight+1;divTou.style.width=divTi.clientWidth;divSum.style.width=divTi.clientWidth;document.body.attachEvent("onmouseover",function(){window.event.cancelBubble=true;});document.body.attachEvent("onmousemove",function(){window.event.cancelBubble=true;});tabTi.attachEvent("onmousedown",this.doclick);tabTi.attachEvent("onkeydown",this.dokeydownTab);divTi.attachEvent("onscroll",this.doscroll);divTou.attachEvent("onmousedown",this.domousedown);divTou.attachEvent("onmouseup",this.domouseup);divTou.attachEvent("onmousemove",this.domousemove);divTou.attachEvent("onmouseout",this.domouseout);tabTou.attachEvent("onclick",this.doTabTouClick);divAll.attachEvent("onresize",this.doresize);tabTi.attachEvent("ondblclick",this.dblclickEvent);tabTi.attachEvent("onclick",this.clickEvent);if(clickEvent!=""&&clickEvent!=null)tabTi.attachEvent("onclick",clickEvent);if(dblclickEvent!=""&&dblclickEvent!=null)tabTi.attachEvent("ondblclick",dblclickEvent);var sort=inputSort.value.toString();var sortname=inputSortName.value.toString();for(var i=1;i<tabTou.rows[0].cells.length-1;i++){var obj=tabTou.rows[0].cells[i];obj=obj.children[0];if(obj.tagName=="SPAN"){var attname=obj.getAttribute("sortName");if(attname==sortname){lastSortTd=obj;if(sort.toUpperCase()=="DESC"){obj.children[0].innerText="6";obj.children[0].style.display="inline";}else{obj.children[0].innerText="5";obj.children[0].style.display="inline";};};};};this.showLeft(hasLeft);};};this.showLeft=showLeft;function showLeft(hasLeft){var dis=null;if(hasLeft=="true"&&divTouLeftCol.style.display=="none"){dis="";var col=document.createElement("COL");tabTou.children[0].insertAdjacentElement("afterBegin",col);col.width="30px";divTiLeftCol.style.display="";if(divSum.style.display!="none"){divSumLeftCol.style.display="";tabSum.rows[0].cells[0].style.display="";};}else if(hasLeft=="false"&&divTouLeftCol.style.display!="none"){dis="none";divSumLeftCol.style.display="none";divTiLeftCol.style.display="none";tabSum.rows[0].cells[0].style.display="none";}else return;divTouLeftCol.style.display=dis;var i=0;var tou=null;var ti=null;while(i<tabTou.rows.length&&(tou=tabTou.rows[i++].cells[0]))tou.style.display=dis;i=0;while(i<tabTi.rows.length&&(ti=tabTi.rows[i++].cells[0]))ti.style.display=dis;};this.addHr=addHr;function addHr(){var ohr=document.createElement("hr");ohr.width=1;ohr.size=20;ohr.color="black";ohr.style.position="absolute";ohr.style.display="none";document.body.appendChild(ohr);curHr=ohr;};this.lightLine=lightLine;function lightLine(otr){if(otr.rowIndex==0)return;if(otr!=null&&otr.tagName=="TR"){try{otr.className="lightSkin";}catch(ex){return;};};};this.delightLine=delightLine;function delightLine(otr){if(otr!=null&&otr.tagName=="TR"){try{otr.className="";}catch(ex){return;};};};this.doclick=doclick;function doclick(){var obj=window.event.srcElement;if(obj==null)return;var oTr=null;switch(obj.tagName){case"TR":oTr=obj;break;case"TD":oTr=obj.parentElement;break;case"SPAN":oTr=obj.parentElement.parentElement;break;case"INPUT":oTr=obj.parentElement.parentElement;if(obj.type=="checkbox"||obj.type=="radio")doCheck(obj);break;case"SELECT":oTr=obj.parentElement.parentElement;break;default:return;};try{if(currentLine!=null)delightLine(currentLine);if(oTr!=null)lightLine(oTr);currentLine=oTr;}catch(ex){};};this.dokeydownTab=function(){var obj=window.event.srcElement;var otd=obj.parentElement;if(otd==null||otd.tagName!="TD")return false;var otr=otd.parentElement;if(otr==null||otr.tagName!="TR")return false;var tab=otr.parentElement.parentElement;if(tab==null||tab.tagName!="TABLE")return;if(obj==null)return;try{if(window.event.keyCode==38&&tab==tabTi)moveFocus(obj,-1);if(window.event.keyCode==40&&tab==tabTi)moveFocus(obj,1);if(window.event.keyCode==37&&tab==tabTi){event.returnValue=false;event.cancelBubble=true;};if(window.event.keyCode==39&&tab==tabTi){event.returnValue=false;event.cancelBubble=true;};}catch(ex){};};this.IsLast=IsLast;function IsLast(obj){if(obj==null)return;var otd=obj.parentElement;if(otd==null||otd.tagName!="TD")return false;var otr=tabTi.rows[tabTi.rows.length-2];if(otr==null||otr.tagName!="TR")return false;if(otr.cells[otr.cells.length-1]==otd)return true;else return false;};this.moveFocusUd=moveFocusUd;function moveFocusUd(obj,par){if(obj==null)return;var otd=obj.parentElement;if(otd==null||otd.tagName!="TD")return false;var otr=otd.parentElement;if(otr==null||otr.tagName!="TR")return false;var trindex=otr.rowIndex;var tdindex=countOT(otd);try{if(tdindex+par>otr.cells.length-1||tdindex+par<0)return;var ntd=otr.cells[tdindex+par];if(ntd.children[0]!=null)ntd.children[0].focus();}catch(ex){alert("发生错误！"+ex.description);};};this.movetToRight=movetToRight;function movetToRight(obj){if(obj==null)return;var otd=obj.parentElement;if(otd==null||otd.tagName!="TD")return false;var otr=otd.parentElement;if(otr==null||otr.tagName!="TR")return false;var index=parseInt(otd.getAttribute("index"))+parseInt(1);var objNext=null;var tdindex=countOT(otd);var trindex=otr.rowIndex;var i;for(i=tdindex;i<otr.cells.length;i++){var objTemp=otr.cells[i];if(objTemp.display!="none"&&objTemp.getAttribute("index")==index){objNext=otr.cells[i];break;};};if(otd==otr.cells[otr.cells.length-2]){if(trindex==tabTi.rows.length-1){addRow();};var nobj=findFTd(otr.nextSibling).children[0];if(nobj!=null)nobj.focus();return;};objNext.children[0].focus();};this.movetToLeft=movetToLeft;function movetToLeft(obj){if(obj==null)return;var otd=obj.parentElement;if(otd==null||otd.tagName!="TD")return false;var otr=otd.parentElement;if(otr==null||otr.tagName!="TR")return false;var index=parseInt(otd.getAttribute("index"))-parseInt(1);var objNext=otr.cells[i];var tdindex=countOT(otd);var trindex=otr.rowIndex;var i;for(i=tdindex;i>=0;i--){var objTemp=otr.cells[i];if(parseInt(objTemp.getAttribute("index"))<=index){objNext=otr.cells[i];break;};};if(i<0){if(trindex==1){return};var nobjtr=otr.parentElement.rows[trindex-1];var nobj=nobjtr.children[nobjtr.cells.length-1].children[0];if(nobj!=null)nobj.focus();return;};objNext.children[0].focus();};this.moveFocus=moveFocus;function moveFocus(obj,par){if(obj==null)return;var otd=obj.parentElement;if(otd==null||otd.tagName!="TD")return false;var otr=otd.parentElement;if(otr==null||otr.tagName!="TR")return false;var trindex=otr.rowIndex;var tdindex=otd.cellIndex;try{if(trindex+par>=tabTi.rows.length)return;var ntr=tabTi.rows[trindex+par];var ntd=ntr.cells[tdindex];if(trindex==1&&par==-1){tabTi.rows[1].cells[tdindex].children[0].focus();tabTi.rows[1].cells[tdindex].children[0].checked=true;delightLine(currentLine);lightLine(tabTi.rows[1]);currentLine=tabTi.rows[1];return;};delightLine(currentLine);lightLine(ntr);currentLine=ntr;}catch(ex){};};this.countOT=countOT;function countOT(otd){if(otd==null||otd.tagName!="TD")return;for(var i=0;i<otd.parentElement.cells.length;i++){var td=otd.parentElement.cells[i];if(td==otd)return i;};};this.findFTd=findFTd;function findFTd(otr){if(otr==null||otr.tagName!="TR")return;for(var i=0;i<otr.cells.length;i++){var td=otr.cells[i];if(td==null)continue;if(td.style.display=="none")continue;else return td;};};this.addLine=addLine;function addLine(){if(tabTi==null&&tabTi.tagName!="TABLE")return;var tr=tabTi.rows[0];if(tr!=null){try{tabTi.rows[0].style.display="block";var ntr=tabTi.insertRow();for(var i=0;i<tabTi.rows[0].cells.length;i++){var otd=ntr.insertCell();otd.innerHTML=tabTi.rows[0].cells[i].innerHTML;otd.width=tabTi.rows[0].cells[i].width;otd.index=tabTi.rows[0].cells[i].index;otd.style.display=tabTi.rows[0].cells[i].style.display;};if(currentLine!=null)delightLine(currentLine);currentLine=tabTi.rows[tabTi.rows.length-1];latd2=tabTi.rows[tabTi.rows.length-1];lightLine(latd2);if(divTiLeftCol!=null&&divTiLeftCol.children[0]!=null){var tableft=divTiLeftCol.children[0];var row=tableft.insertRow();var otd=row.insertCell();var rowindex=row.rowIndex;otd.innerHTML="<span>"+(rowindex+1)+"</span>";};divTi.scrollTop=divTi.scrollHeight;}catch(ex){alert("增加一行失败！"+ex.description);return;};};};this.addHeight=addHeight;function addHeight(){if(tabTi==null&&tabTi.tagName!="TABLE")return;try{curDivHeight=parseInt(curDivHeight)+parseInt(curTrHeight);}catch(ex){alert("增加高度失败！");return;};};this.delLine=function(){if(tabTi==null&&tabTi.tagName!="TABLE")return;try{if(currentLine!=null){var oldTr=currentLine.rowIndex;var isdel=currentLine.removeNode(true);currentLine=null;if(divTiLeftCol!=null&&divTiLeftCol.children[0]!=null){var tableft=divTiLeftCol.children[0];if(tableft.rows.length>0)tableft.rows[tableft.rows.length-1].removeNode(true);};divTou.style.width=divTi.clientWidth;divSum.style.width=divTi.clientWidth;};}catch(ex){alert("删除一行失败2！"+ex.description);return;};};this.addRow=addRow;function addRow(){addLine();divTiLeftCol.style.height=divTi.clientHeight-divSum.clientHeight+1;divTou.style.width=divTi.clientWidth;divSum.style.width=divTi.clientWidth;};this.delRow=delRow;function delRow(){try{if(tabTi==null&&tabTi.tagName!="TABLE")return;if(tabTi.rows.length==1)return;if(currentLine==null)return;this.delLine();}catch(ex){};divTou.style.width=divTi.clientWidth;divSum.style.width=divTi.clientWidth;};this.doscroll=doscroll;function doscroll(){if(divTi==null)return;divTiLeftCol.scrollTop=divTi.scrollTop;if(divTou==null)return;if(divSum==null)return;var disWid=divTi.scrollLeft;divTou.scrollLeft=disWid;divSum.scrollLeft=disWid;};this.domousedown=domousedown;function domousedown(){var obj=window.event.srcElement;var nextTd=null;if(obj==null||(obj.tagName!="SPAN"&&obj.tagName!="TD"))return;if(obj.tagName=="SPAN")obj=obj.parentElement;nextTd=obj.previousSibling;while(nextTd!=null&&nextTd.style.display=="none"){nextTd=nextTd.previousSibling;};var absLeft=0;var odiv=divAll;while(odiv!=document.body){absLeft+=odiv.offsetLeft;odiv=odiv.offsetParent;};if(window.event.x+document.body.scrollLeft+divTi.scrollLeft>absLeft+obj.offsetLeft+obj.offsetWidth-13){curTd=obj;isMouDown=true;isCanSort=false;OldPlace=window.event.x+window.document.body.scrollLeft+divTi.scrollLeft;}else if(window.event.x+document.body.scrollLeft+divTi.scrollLeft>absLeft+obj.offsetLeft&&window.event.x+document.body.scrollLeft+divTi.scrollLeft<absLeft+obj.offsetLeft+13){if(nextTd.cellIndex==0)return;curTd=nextTd;isMouDown=true;isCanSort=false;OldPlace=window.event.x+window.document.body.scrollLeft+divTi.scrollLeft;}else isCanSort=true;};this.dblclickEvent=dblclickEvent;function dblclickEvent(){};this.clickEvent=clickEvent;function clickEvent(){};this.domousemove=domousemove;function domousemove(){var obj=window.event.srcElement;if(obj==null||(obj.tagName!="SPAN"&&obj.tagName!="TD"))return;if(obj.tagName=="SPAN"){obj=obj.parentElement;};var absLeft=0;var odiv=divAll;while(odiv!=document.body){absLeft+=odiv.offsetLeft;odiv=odiv.offsetParent;};if(window.event.x+document.body.scrollLeft+divTi.scrollLeft>absLeft+obj.offsetLeft+obj.offsetWidth-13||(window.event.x+document.body.scrollLeft+divTi.scrollLeft>absLeft+obj.offsetLeft&&window.event.x+document.body.scrollLeft+divTi.scrollLeft<absLeft+obj.offsetLeft+13&&obj.cellIndex!=1)||isMouDown){try{divTou.style.cursor="col-resize";}catch(ex){divTou.style.cursor="move";};}else{divTou.style.cursor="hand";};};this.domouseup=domouseup;function domouseup(){if(isMouDown){try{nowPlace=window.event.x+document.body.scrollLeft+divTi.scrollLeft;if(isNaN(OldPlace-nowPlace)){isMouDown=false;return;};curTd.width=curTd.width-(OldPlace-nowPlace);isMouDown=false;var tdIndex=countOT(curTd);for(var i=0;i<tabTi.rows.length;i++){var otd=tabTi.rows[i].cells[tdIndex];if(otd!=null){otd.width=otd.width-(OldPlace-nowPlace);};};for(var i=0;i<tabSum.rows.length;i++){var otd=tabSum.rows[i].cells[tdIndex];if(otd!=null){otd.width=otd.width-(OldPlace-nowPlace);};};divTiLeftCol.style.height=divTi.clientHeight-divSum.clientHeight+1;divTou.style.width=divTi.clientWidth;divSum.style.width=divTi.clientWidth;divSum.parentElement.style.top=parseInt(divTi.offsetTop)+parseInt(divTi.clientHeight)-(parseInt(divSum.clientHeight))+1;}catch(ex){isMouDown=false;alert("您拖动的区域无效!");};};};this.domouseout=domouseout;function domouseout(){};this.setSubmit=setSubmit;function setSubmit(val){isSubmit=val;};this.clickTou=clickTou;function clickTou(cell){if(cell==null||cell=="")return;var otd=tabTou.rows[0].cells[cell];doTabTouClick(otd.children[0]);};this.doTabTouClick=doTabTouClick;function doTabTouClick(srcobj){var obj=null;if(srcobj.tagName==null)obj=window.event.srcElement;else obj=srcobj;if(obj==null)return;if(obj.tagName!="SPAN")return;if(obj.innerText=="")return;var objcheckAll=obj.getAttribute("enableCheckAll");this.format=obj.getAttribute("format");if(objcheckAll=="true"){if(obj.children[0].innerText=="6"){doCheckAllLine(true,obj.parentElement.cellIndex);obj.children[0].innerText="5";obj.children[0].style.display="block";}else{doCheckAllLine(false,obj.parentElement.cellIndex);obj.children[0].innerText="6";obj.children[0].style.display="block";};}else{if(outCanSort!=true)return;var objcansort=obj.getAttribute("CanSort");if(objcansort=="false")return;if(isSubmit){if(!isCanSort)return;if(inputSort!=null&&inputSortName!=null){var sort=inputSort.value;var sortname=inputSortName.value;if(obj.tagName=="SPAN"){var attname=obj.getAttribute("sortName");if(attname==sortname){if(sort.toUpperCase()=="DESC"){inputSort.value="ASC";obj.children[0].innerText=="6";obj.children[0].style.display="block";}else{inputSort.value="DESC";obj.children[0].innerText=="5";obj.children[0].style.display="block";};}else{inputSortName.value=attname;inputSort.value="ASC";obj.children[0].innerText=="5";obj.children[0].style.display="block";};};if(document.forms[0]!=null)document.forms[0].submit();};}else{if(!isCanSort)return;if(obj.tagName=="SPAN"){if(lastSortTd!=null)lastSortTd.children[0].style.display="none";if(obj.children[0].innerText=="6"){obj.children[0].innerText="5";obj.children[0].style.display="inline";orderType="0";}else{obj.children[0].innerText="6";obj.children[0].style.display="inline";orderType="1";};lastSortTd=obj;obj=obj.parentElement;};if(obj.tagName=="LABEL"){if(obj.innerText=="6"){obj.innerText="5";orderType="0";}else{obj.innerText="6";orderType="1";};obj=obj.parentElement.parentElement;};if(obj.tagName!="TD")return;var colindex=countOT(obj);makePlanar();sortArray(colindex-1);fillData();this.format="";};};};this.doresize=doresize;function doresize(){divTou.style.width=divTi.clientWidth;divSum.style.width=divTi.clientWidth;divTiLeftCol.style.height=divTi.clientHeight-divSum.clientHeight+1;divSum.parentElement.style.top=parseInt(divTi.offsetTop)+parseInt(divTi.clientHeight)-(parseInt(divSum.clientHeight))+1;};this.focus=focus;function focus(row,col){delightLine(currentLine);if(tabTi==null&&tabTi.tagName!="TABLE")return;var otr=tabTi.rows[row];if(otr==null)return;if(otr.style.display!="none"&&otr.rowIndex!=0&&otr.rowIndex!=tabTi.rows.length){lightLine(otr);currentLine=otr;try{var otd=otr.cells[col];if(otd!=null&&otd.children[0]!=null)otd.children[0].focus();}catch(ex){alert("定位焦点失败！");};};};this.setCellValue=setCellValue;function setCellValue(row,col,value){if(tabTi==null&&tabTi.tagName!="TABLE")return;var otr=tabTi.rows[row];if(otr==null)return;if(otr.style.display!="none"){try{var index=0;for(var i=1;i<otr.cells.length;i++){var otd=otr.cells[i];if(i==col){if(otd.children[0]!=null&&otd.children[0].tagName=="INPUT")otd.children[0].value=value;else otd.innerText=value;};};}catch(ex){return null;};};};this.getCellValue=getCellValue;function getCellValue(row,col){if(tabTi==null&&tabTi.tagName!="TABLE")return;var otr=tabTi.rows[row];if(otr==null)return;if(otr.style.display!="none"){try{var index=0;for(var i=1;i<otr.cells.length;i++){var otd=otr.cells[i];if(i==col){if(otd.children[0]!=null&&otd.children[0].tagName=="INPUT")return otd.children[0].value;return otd.innerText;};};}catch(ex){return null;};};};this.getCell=getCell;function getCell(row,col){if(tabTi==null&&tabTi.tagName!="TABLE")return;var otr=tabTi.rows[row];if(otr==null)return;if(otr.style.display!="none"){try{var index=0;for(var i=1;i<otr.cells.length;i++){var otd=otr.cells[i];if(i==col){return otd;};};}catch(ex){return null;};};};this.returnRowCount=returnRowCount;function returnRowCount(){if(tabTi==null&&tabTi.tagName!="TABLE")return;return tabTi.rows.length-1;};this.sum=sum;function sum(col){if(col=="")return;if(tabTi==null&&tabTi.tagName!="TABLE")return;var sum=0;for(var i=1;i<tabTi.rows.length;i++){if(tabTi.rows[i].style.display=="none")continue;var otd=tabTi.rows[i].cells[col];if(otd!=null&&otd.children[0]!=null){var val=parseFloat(otd.children[0].value);if(isNaN(val))val=0;sum+=val;};};return sum;};this.setSumValue=setSumValue;function setSumValue(){if(tabSum==null&&tabSum.tagName!="TABLE")return;if(tabTi==null&&tabTi.tagName!="TABLE")return;try{for(var i=1;i<tabTi.rows[0].cells.length;i++){var sum=0;for(var j=1;j<tabTi.rows.length;j++){var col=tabTi.rows[j].cells[i];if(col==null)continue;var val=col.innerText;var head_Cell=tabTou.rows[0].cells[i];if(head_Cell&&head_Cell.children[0]&&head_Cell.children[0].format){var num_foramt=head_Cell.children[0].format;if(num_foramt!=""&&num_foramt.indexOf("#")!=-1){var num_separator=num_foramt.substring(num_foramt.indexOf("#")+1);var reg_Exp=new RegExp(num_separator,"g");val=val.replace(reg_Exp,"");};};if(isNaN(val))continue;sum+=parseFloat(val);};if(sum!=0&&!isNaN(sum))tabSum.rows[0].cells[i].innerHTML="<span>"+sum+"</span>";};}catch(ex){alert("为合计区赋值失败！");};};this.getSumFieldValue=getSumFieldValue;function getSumFieldValue(col){if(tabSum==null&&tabSum.tagName!="TABLE")return;var otr=tabSum.rows[0];if(otr==null)return;try{var otd=otr.cells[col];if(otd!=null){return(otd.innerText);};}catch(ex){return null;};};this.getCurrentLine=getCurrentLine;function getCurrentLine(){if(currentLine==null)return null;return currentLine.rowIndex;};this.doCheck=doCheck;function doCheck(obj){if(obj!=null&&obj.type=="checkbox"){if(inputPk==null)return;var str=inputPk.value;if(obj.checked){if(str.indexOf(obj.value)>-1){restr=new RegExp(","+obj.value);str=str.replace(restr,"");};}else{str+=","+obj.value;};inputPk.value=str;};if(obj!=null&&obj.type=="radio"){if(inputPk==null)return;inputPk.value=obj.value;};};this.getCheckLine=getCheckLine;function getCheckLine(flag){if(flag==null||flag=="")flag=",";if(tabTi==null&&tabTi.tagName!="TABLE")return"";try{var col=null;for(var i=0;i<tabTi.rows[1].cells.length;i++){var otd=tabTi.rows[1].cells[i].children[0];if(otd!=null&&(otd.type=="checkbox"||otd.type=="radio")){col=i;break;};};if(col==null||isNaN(col))return"";var str="";for(var j=1;j<tabTi.rows.length;j++){if(tabTi.rows[j].cells[col].children[0].tagName=="INPUT"){if(tabTi.rows[j].cells[col].children[0].checked)str+=tabTi.rows[j].cells[col].children[0].value+flag;};};return str.substring(0,str.length-1);}catch(ex){return"";};};this.getCheckAll=getCheckAll;function getCheckAll(flag1,flag2){if(flag1==null||flag1=="")flag1=",";if(flag2==null||flag2=="")flag2="|";if(tabTi==null&&tabTi.tagName!="TABLE")return"";try{var col=null;for(var i=0;i<tabTi.rows[1].cells.length;i++){var otd=tabTi.rows[1].cells[i].children[0];if(otd!=null&&(otd.type=="checkbox"||otd.type=="radio")){col=i;break;};};if(col==null||isNaN(col))return"";var str="";for(var j=1;j<tabTi.rows.length;j++){if(tabTi.rows[j].cells[col].children[0].tagName=="INPUT"){if(tabTi.rows[j].cells[col].children[0].checked){for(var k=1;k<tabTi.rows[j].cells.length;k++){var ootd=tabTi.rows[j].cells[k];if(ootd.children[0]!=null){var val="";if(ootd.children[0].tagName=="INPUT")val=ootd.children[0].value;else val=ootd.children[0].innerText;if(val==null)val="";str+=val+flag1;};};str+=flag2;};};};return str.substring(0,str.length-1);}catch(ex){return"";};};this.getCheckLineNo=getCheckLineNo;function getCheckLineNo(){if(tabTi==null&&tabTi.tagName!="TABLE")return"";try{var col=null;for(var i=0;i<tabTi.rows[1].cells.length;i++){var otd=tabTi.rows[1].cells[i].children[0];if(otd!=null&&(otd.type=="checkbox"||otd.type=="radio")){col=i;break;};};if(col==null||isNaN(col))return"";var str="";for(var j=1;j<tabTi.rows.length;j++){if(tabTi.rows[j].cells[col].children[0].checked)str+=j+",";};return str.substring(0,str.length-1);}catch(ex){return"";};};this.doCheckAllLine=doCheckAllLine;function doCheckAllLine(isCheck,colIndex){var col=-1;if(tabTi==null&&tabTi.tagName!="TABLE")return"";try{for(var i=0;i<tabTi.rows[1].cells.length;i++){var otd=tabTi.rows[1].cells[i];if(otd.style.display!="none"){col++;};if(col==colIndex){col=i;break;};};if(col==null||isNaN(col))return false;var str="";if(isCheck){for(var j=1;j<tabTi.rows.length;j++){if(tabTi.rows[j].cells[col].children[0].disabled!=true)tabTi.rows[j].cells[col].children[0].checked=true;};return true;}else{for(var j=1;j<tabTi.rows.length;j++){if(tabTi.rows[j].cells[col].children[0].disabled!=true)tabTi.rows[j].cells[col].children[0].checked=false;};return true;};}catch(ex){return false;};};this.makePlanar=makePlanar;function makePlanar(){if(tabTi==null)return;if(tableArray==null)tableArray=new Array();var rowArray;for(var i=1;i<tabTi.rows.length;i++){rowArray=new Array();for(var j=0;j<tabTi.rows[0].cells.length;j++){var otd=tabTi.rows[i].cells[j];var otxt="";rowArray.push({text:otd.innerText,html:otd.innerHTML});};tableArray[i-1]=rowArray;};};this.sortArray=sortArray;function sortArray(col){if(tableArray[0]==null)return;if(typeof(col)!="number")return;if(col>=tableArray[0].length)return;sortCol=col;tableArray.sort(sortFun);if(orderType=="1")tableArray.reverse();};this.fillData=fillData;function fillData(){if(tableArray==null)return;for(var i=1;i<tabTi.rows.length;i++){for(var j=0;j<tabTi.rows[0].cells.length;j++){if(tableArray[i-1][j]!=null&&tableArray[i-1][j]!="")tabTi.rows[i].cells[j].innerHTML=tableArray[i-1][j].html;};};};this.sortFun=sortFun;function sortFun(par1,par2){if(typeof(par1)=="object"&&typeof(par1)=="object"){par1=par1[sortCol+1];par2=par2[sortCol+1];};par1=par1.text;par2=par2.text;if(sortType=="1"){if(this.format&&this.format!=""&&this.format.indexOf("#")!=-1){var num_format=format.substring(format.indexOf("#")+1);var reg_Exp=new RegExp(num_format,"g");par1=par1.replace(reg_Exp,"");par2=par2.replace(reg_Exp,"");};if(!isNaN(par1)&&!isNaN(par2)){if(parseFloat(par1)>parseFloat(par2))return 1;else if(parseFloat(par1)<parseFloat(par2))return-1;if(parseFloat(par1)==parseFloat(par2))return 0;};if(typeof(par1)=="string"&&typeof(par1)=="string"){if(par1.substring(0,1)=="￥"&&par2.substring(0,1)=="￥"){if(parseFloat(par1.substring(1,par1.length))>parseFloat(par2.substring(1,par2.length)))return 1;else if(parseFloat(par1.substring(1,par1.length))<parseFloat(par2.substring(1,par2.length)))return-1;if(parseFloat(par1.substring(1,par1.length))==parseFloat(par2.substring(1,par2.length)))return 0;};if(par1.substr(par1.length-1,1)=="%"&&par2.substr(par2.length-1,1)=="%"){if(parseFloat(par1.substring(0,par1.length-1))>parseFloat(par2.substring(0,par2.length-1)))return 1;else if(parseFloat(par1.substring(0,par1.length-1))<parseFloat(par2.substring(0,par2.length-1)))return-1;if(parseFloat(par1.substring(0,par1.length-1))==parseFloat(par2.substring(0,par2.length-1)))return 0;};par1=par1.toString();par2=par2.toString();if(par1>par2)return 1;if(par1<par2)return-1;if(par1==par2)return 0;};}else{par1=par1.toString();par2=par2.toString();if(par1>par2)return 1;if(par1<par2)return-1;if(par1==par2)return 0;};return 0;};this.setCanSort=setCanSort;function setCanSort(val){outCanSort=val;};this.setTouText=setTouText;function setTouText(col,val){if(tabTou==null)return;var otd=tabTou.rows[0].cells[col];var ospan=otd.children[0];var olabel=ospan.children[0];ospan.innerHTML=val+olabel.outerHTML;};this.setTouAlign=setTouAlign;function setTouAlign(col,val){if(tabTou==null)return;var otd=tabTou.rows[0].cells[col];var ospan=otd.children[0];ospan.style.textAlign=val;};this.setSumAlign=setSumAlign;function setSumAlign(col,val){if(tabSum==null)return;var otd=tabSum.rows[0].cells[col];var ospan=otd.children[0];ospan.style.textAlign=val;};this.setSumCellText=setSumCellText;function setSumCellText(col,val){if(tabSum==null)return;var otd=tabSum.rows[0].cells[col];var ospan=otd.children[0];ospan.innerHTML=val;};this.setTiValue=setTiValue;function setTiValue(row,col,val){if(tabTi==null)return;var otd=tabTi.rows[row].cells[col];otd.innerHTML="<span>"+val+"</span>";};this.setSumText=setSumText;function setSumText(val){if(divSum==null)return;var divsumnext=divSum.nextSibling.children[0];if(divsumnext==null)return;divsumnext.children[0].rows[0].cells[0].innerText=val;};this.setTabTiClick=setTabTiClick;function setTabTiClick(evevtstr){if(tabTi==null)return;if(evevtstr==null||evevtstr=="")return;tabTi.attachEvent("onclick",evevtstr);};this.TreeInit=TreeInit;function TreeInit(xmlstr,openflag,closeflag){if(xmlstr==null||xmlstr=="")return;OpenImg=openflag;CloseImg=closeflag;xmlroot=new ActiveXObject("MSXML.Domdocument");xmlroot.loadXML(xmlstr);xmlroot=xmlroot.documentElement;for(var i=0;i<xmlroot.childNodes.length;i++){var onode=xmlroot.childNodes[i];paddingLeft=0;InitTreeNode(onode);};AddImgEvent();divTiLeftCol.style.height=divTi.clientHeight-divSum.clientHeight+1;divTou.style.width=divTi.clientWidth;divSum.style.width=divTi.clientWidth;divSum.parentElement.style.top=parseInt(divTi.offsetTop)+parseInt(divTi.clientHeight)-(parseInt(divSum.clientHeight))+1;};this.InitTreeNode=InitTreeNode;function InitTreeNode(node){if(node==null)return;paddingLeft+=15;for(var i=0;i<node.childNodes.length;i++){var onode=node.childNodes[i];var onodeid=onode.getAttribute("NodeId");PaddingRow(onodeid);HidRow(onodeid);if(onode.childNodes.length>0)InitTreeNode(onode);else{closeImg(onodeid);};};paddingLeft-=15;};this.AddImgEvent=AddImgEvent;function AddImgEvent(){if(tabTi==null)return;for(var i=1;i<tabTi.rows.length;i++){var otr=tabTi.rows[i];var otd=otr.cells[1];var odiv=otd.children[0];var oimg=odiv.children[0];if(oimg!=null&&oimg.tagName=="IMG")oimg.attachEvent("onclick",doImgClick);};};this.HidLeft=HidLeft;function HidLeft(){var tabLeft=divTiLeftCol.children[0];var Ltr=null;for(var j=tabLeft.rows.length-1;j>=0;j--){var otr=tabLeft.rows[j];if(otr.style.display!="none"){Ltr=otr;break;};};if(Ltr!=null)Ltr.style.display="none";};this.ShowLeft=ShowLeft;function ShowLeft(){var tabLeft=divTiLeftCol.children[0];var Ltr=null;for(var j=0;j<tabLeft.rows.length;j++){var otr=tabLeft.rows[j];if(otr.style.display=="none"){Ltr=otr;break;};};if(Ltr!=null)Ltr.style.display="block";};this.HidRow=HidRow;function HidRow(id){if(tabTi==null)return;for(var i=1;i<tabTi.rows.length;i++){var otr=tabTi.rows[i];var otd=otr.cells[1];var odiv=otd.children[0];var oimg=odiv.children[0];if(oimg.nodeid==id){if(otr.style.display!="none"){otr.style.display="none";HidLeft();};};};};this.closeImg=closeImg;function closeImg(id){if(tabTi==null)return;for(var i=1;i<tabTi.rows.length;i++){var otr=tabTi.rows[i];var otd=otr.cells[1];var odiv=otd.children[0];var oimg=odiv.children[0];if(oimg.nodeid==id){oimg.isLast="1";oimg.src=CloseImg;};};};this.ShowRow=ShowRow;function ShowRow(id){if(tabTi==null)return;for(var i=1;i<tabTi.rows.length;i++){var otr=tabTi.rows[i];var otd=otr.cells[1];var odiv=otd.children[0];var oimg=odiv.children[0];if(oimg.nodeid==id){otr.style.display="block";if(odiv.offsetWidth>otd.offsetWidth+3)addWidth(1,odiv.offsetWidth);ShowLeft();ChangeImg2(oimg);};};};this.PaddingRow=PaddingRow;function PaddingRow(id){if(tabTi==null)return;for(var i=1;i<tabTi.rows.length;i++){var otr=tabTi.rows[i];var otd=otr.cells[1];var odiv=otd.children[0];var oimg=odiv.children[0];if(oimg.nodeid==id){var width1=odiv.offsetWidth;var width2=paddingLeft+oimg.offsetWidth;if(width1<width2)addWidth(1,width2);odiv.style.paddingLeft=paddingLeft;};};};this.addWidth=addWidth;function addWidth(col,wid){tabTou.rows[0].cells[col].width=wid+5;tabSum.rows[0].cells[col].width=wid+5;for(var i=0;i<tabTi.rows.length;i++){var otd=tabTi.rows[i].cells[col];if(otd!=null){otd.width=wid+5;};};};this.doImgClick=doImgClick;function doImgClick(){var img=window.event.srcElement;if(img.tagName!="IMG")return;var nodeid=img.nodeid;if(img.open!="1"){OpenNode(null,nodeid);ChangeImg1(img);}else{CloseNode(null,nodeid);ChangeImg2(img);};divTiLeftCol.style.height=divTi.clientHeight-divSum.clientHeight+1;divTou.style.width=divTi.clientWidth;divSum.style.width=divTi.clientWidth;divSum.parentElement.style.top=parseInt(divTi.offsetTop)+parseInt(divTi.clientHeight)-(parseInt(divSum.clientHeight))+1;};this.ChangeImg1=ChangeImg1;function ChangeImg1(img){if(img!=null&&img.tagName=="IMG"){if(img.isLast=="1")return;img.src=CloseImg;img.open="1";};};this.ChangeImg2=ChangeImg2;function ChangeImg2(img){if(img!=null&&img.tagName=="IMG"){if(img.isLast=="1")return;img.src=OpenImg;img.open="0";};};this.OpenNode=OpenNode;function OpenNode(xmlnode,nodeid){if(xmlroot==null)return;if(xmlnode==null)xmlnode=xmlroot;for(var i=0;i<xmlnode.childNodes.length;i++){var onode=xmlnode.childNodes[i];if(onode.getAttribute("NodeId")==nodeid){ZhanKai(onode);return;};if(onode.hasChildNodes()){OpenNode(onode,nodeid);};};};this.CloseNode=CloseNode;function CloseNode(xmlnode,nodeid){if(xmlroot==null)return;if(xmlnode==null)xmlnode=xmlroot;for(var i=0;i<xmlnode.childNodes.length;i++){var onode=xmlnode.childNodes[i];if(onode.getAttribute("NodeId")==nodeid){GuanBi(onode);return;};if(onode.hasChildNodes()){CloseNode(onode,nodeid);};};};this.ZhanKai=ZhanKai;function ZhanKai(onode){for(var i=0;i<onode.childNodes.length;i++){var oonode=onode.childNodes[i];var ooid=oonode.getAttribute("NodeId");ShowRow(ooid);};};this.GuanBi=GuanBi;function GuanBi(onode){for(var i=0;i<onode.childNodes.length;i++){var oonode=onode.childNodes[i];var ooid=oonode.getAttribute("NodeId");HidRow(ooid);if(oonode.hasChildNodes())GuanBi(oonode);};};this.OpenNodeById=OpenNodeById;function OpenNodeById(ids){if(ids==null||ids=="")return;var arrid=ids.split(",");var imgs=divAll.getElementsByTagName("img");for(var i=0;i<arrid.length;i++){if(arrid[i]==null||arrid[i]=="")continue;for(var j=0;j<imgs.length;j++){var oimg=imgs[j];if(oimg.nodeid==arrid[i]){oimg.click();};};};};this.resetPageIndex=resetPageIndex;function resetPageIndex(){document.all('org.loushang.web.taglib.util.GRIDINFOPRIMARY').value=null;document.all("org.loushang.web.taglib.util.RESETPAGEINDEX").value="true";};};function resetPageIndex(){var oField=document.all('org.loushang.web.taglib.util.GRIDINFOPRIMARY');if(oField!=null)oField.value=null;oField=document.all("org.loushang.web.taglib.util.RESETPAGEINDEX");if(oField!=null)oField.value="true";};
